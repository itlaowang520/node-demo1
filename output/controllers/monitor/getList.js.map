{"version":3,"sources":["../../../src/controllers/monitor/getList.js"],"names":["url","require","getMonitorListController","context","next","list","params","qs","parse","request","query","pageSize","pageNo","MonitorModel","getList","message","throw","taskName","filter","item","count","length","AppFunc","isEmptyObject","body","totalCount","Number"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA,IAAMA,GAAG,GAAGC,OAAO,CAAC,KAAD,CAAnB;;SAEeC,wB;;;;;wFAAf,iBAAwCC,OAAxC,EAAiDC,IAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,YAAAA,IADR,GACe,EADf,EAEQC,MAFR,GAEiBC,qBAAGC,KAAH,CAASR,GAAG,CAACQ,KAAJ,CAAUL,OAAO,CAACM,OAAR,CAAgBT,GAA1B,EAA+BU,KAAxC,KAAkD,EAFnE,EAGUC,QAHV,GAG+BL,MAH/B,CAGUK,QAHV,EAGoBC,MAHpB,GAG+BN,MAH/B,CAGoBM,MAHpB;AAAA;AAAA;AAAA,mBAMqBC,iBAAaC,OAAb,EANrB;;AAAA;AAMQT,YAAAA,IANR;AAAA;AAAA;;AAAA;AAAA;AAAA;AAQQ,wBAAEU,OAAF,GAAY,gBAAZ;AACAZ,YAAAA,OAAO,CAACa,KAAR;;AATR;AAWI,gBAAIV,MAAM,CAACW,QAAX,EAAqB;AAEjBZ,cAAAA,IAAI,GAAGA,IAAI,CAACa,MAAL,CAAY,UAACC,IAAD,EAAU;AACzB,uBAAOA,IAAI,CAACF,QAAL,KAAkBX,MAAM,CAACW,QAAhC;AACH,eAFM,CAAP;AAGH;;AAEGG,YAAAA,KAlBR,GAkBgBf,IAAI,CAACgB,MAlBrB;;AAmBI,gBAAI,CAACC,iBAAQC,aAAR,CAAsBjB,MAAtB,CAAL,EAAoC;AAChCD,cAAAA,IAAI,GAAG,0BAAcA,IAAd,EAAoBM,QAApB,EAA8BC,MAA9B,CAAP;AACH;;AAEDT,YAAAA,OAAO,CAACqB,IAAR,GAAe;AACXnB,cAAAA,IAAI,EAAJA,IADW;AAEXoB,cAAAA,UAAU,EAAEL,KAFD;AAGXR,cAAAA,MAAM,EAAEc,MAAM,CAACd,MAAD,CAHH;AAIXD,cAAAA,QAAQ,EAAEe,MAAM,CAACf,QAAD;AAJL,aAAf;AAMAP,YAAAA,IAAI;;AA7BR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;eAgCeF,wB","sourcesContent":["import MonitorModel from '../../models/monitor';\nimport qs from 'querystring';\nimport { pageFormatter } from '../../utils/utils';\nimport AppFunc from '../../utils/appFunc';\nconst url = require('url');\n\nasync function getMonitorListController(context, next) {\n    let list = [],\n        params = qs.parse(url.parse(context.request.url).query) || {}, // 分页参数\n        { pageSize, pageNo } = params;\n\n    try {\n        list = await MonitorModel.getList();\n    } catch (e) {\n        e.message = '获取Monitor列表失败！';\n        context.throw(e);\n    }\n    if (params.taskName) {\n        // 高级查询\n        list = list.filter((item) => {\n            return item.taskName === params.taskName;\n        });\n    }\n\n    let count = list.length;\n    if (!AppFunc.isEmptyObject(params)) {\n        list = pageFormatter(list, pageSize, pageNo);\n    }\n\n    context.body = {\n        list,\n        totalCount: count,\n        pageNo: Number(pageNo),\n        pageSize: Number(pageSize)\n    };\n    next();\n}\n\nexport default getMonitorListController;\n"],"file":"getList.js"}